<!doctype html>
<html>
<head>
	<title>Amalgamatron</title>
</head>
<body>



<div id="status">connecting....</div>

<audio id="tick" src="media/samples/tick.ogg" autobuffer="true"></audio>
<audio id="tick2" src="media/samples/tick.ogg" autobuffer="true"></audio>

<script>

	var SoundChannel = function() {
	}
	SoundChannel.prototype = {
		active: false,
		
		play: function(sound) {
		}
	}

	var SoundManager = function(channels) {
		
	}
	var num = 0;
	
	SoundManager.prototype = {
	
		test: 1,
		sounds: {},
	
		add: function(name, opts) {
			if(!this.sounds[name]) {
				var sound = document.createElement("audio");
				sound.setAttribute("src", "media/samples/" + name + ".ogg");
				sound.setAttribute("autobuffer", true);
				this.sounds[name] = sound;
			}
		},
		play: function(name) {
			if(this.sounds[name]) {
				this.sounds[name].play();
			}
		}
	};

	var sm = new SoundManager();
	sm.add("tick");
	
	var webSocket = new WebSocket('ws://192.168.0.2:4000/music');

	webSocket.onopen = function(event){
		document.getElementById('status').innerHTML = 'connected';
	};

	webSocket.onmessage = function(event){
		
		var obj = JSON.parse(event.data);
		
		switch(obj.action) {
			case "tick":
				//if(num++ % 2 == 0) {
				//	sm.play("tick");
				//} else {
				//	sm.play("alt");
				//}
				break;
			default:
				break;
		}
		//document.getElementById('status').innerHTML += "<br/>" + event.data;
	};

	webSocket.onclose = function(event){
		document.getElementById('status').innerHTML = 'socket closed';
	};
	
	setInterval(function() {
		sm.play("tick");
	}, 500);

</script>



<!--<audio id="a1" src="media/samples/1.wav" autobuffer="true"></audio>
<audio id="a2" src="media/samples/1.wav" autobuffer="true"></audio>
<audio id="a3" src="media/samples/1.wav" autobuffer="true"></audio>
<audio id="a4" src="media/samples/1.wav" autobuffer="true"></audio>
<audio id="a5" src="media/samples/1.wav" autobuffer="true"></audio>
<audio id="a6" src="media/samples/1.wav" autobuffer="true"></audio>
<audio id="a7" src="media/samples/1.wav" autobuffer="true"></audio>
<audio id="a8" src="media/samples/1.wav" autobuffer="true"></audio>-->


</body>
</html>